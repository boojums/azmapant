<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arizona MapAnt</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="L.Control.Opacity.js"></script>
    <script src="proj4.js"></script>
    <script src="Leaflet.MetricGrid.js"></script>
    <link href="L.Control.Opacity.css" rel="stylesheet" />
    <link type="text/css" rel="stylesheet" href="style.css">

    <script>
        function createMap() {
            var map = L.map('mapid');

            var osmBase = new L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            var OpenTopoMap = new L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                maxZoom: 17,
                attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
            });


            var mapantURLTemplate = 'https://storage.googleapis.com/mapant/tiles/{z}/{x}/{y}.png';
            var mapantLayer = new L.tileLayer(mapantURLTemplate, {
                minZoom: 8,
                minNativeZoom: 9,
                maxNativeZoom: 17,
                maxZoom: 17,
                tms: false,
                attribution: ''
            }).addTo(map);

            var osmURLTemplate = 'https://storage.googleapis.com/mapant/osmtiles/{z}/{x}/{y}.png';
            var osmLayer = new L.tileLayer(osmURLTemplate, {
                minZoom: 2,
                minNativeZoom: 5,
                maxNativeZoom: 16,
                maxZoom: 17,
                tms: false,
                attribution: 'Generated by TilesXYZ'
            }).addTo(map);

            var u12GridLayer = L.utmGrid(12, false, {
                color: '#800',
                projection: 'EPSG:3857',
                // latLonClipBounds: [[0, -1 + (29 * 6)], [80, -180 + (29 * 6) + 6]],
                drawClip: false,
                showAxisLabels: [100, 1000, 10000, 100000],
                showSquareLabels: [100000], // label 100km grid squares
                showAxis100km: true
            });


            var baseMaps = {
                "OSM Base": osmBase,
                "OpenTopoMap": OpenTopoMap,
            }
            var overlayMaps = {
                "mapant": mapantLayer,
                "OSM Paths": osmLayer,
                "UTM 12 Grid": u12GridLayer,
                // "Public Lands": publicLandsLayer,
            };

            L.control.layers(baseMaps, overlayMaps,
                {
                    collapsed: false,
                })
                .addTo(map);

            L.control
                .opacity(overlayMaps, {
                    label: 'Layers Opacity',
                })
                .addTo(map);

            new L.control.scale({
                position: 'bottomright',
                imperial: false
            }).addTo(map);

            map.on('moveend', function (e) {
                document.getElementById("zoom-level").textContent = "Zoom " + map.getZoom();
                document.getElementById("where").innerHTML = "<a href=https://boojums.github.io/azmapant/?lat=" + map.getCenter().lat + "&amp;lng=" + map.getCenter().lng +
                    "&amp;zl=" + map.getZoom()
                    + ">"
                    + map.getCenter().lat.toFixed(5) + "," + map.getCenter().lng.toFixed(5) + "</a>";
            });

            return map;
        }

    </script>

</head>

<body>
    <div id="header">
        <div class="left">
            <span id="top-logo"><a href="https://www.tucsonorienteeringclub.org"><img src="toc_logo.png"
                        height="25"></a></span>
            <span id="zoom-level">Zoom</span>
            <span id="where"></span>

        </div>
        <div class="right">
            <span><button id="about-button">About</button></span>
            <span>MapAnt Tucson - Alpha</span>
        </div>
    </div>
    <div id="modal-about" class="modal">
        <div id="about-content" class="modal-content">
            <span class="close">&times;</span>
            <h3>About MapAnt Tucson Alpha</h3>
            <p>I'm just playing around.</p>
        </div>
    </div>

    <div id="mapid"></div>
    <script>
        var map = createMap();

        var params = {};
        window.location.href.replace(/#.*/, "").replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
            params[key] = value;
        });

        var lat = params.lat || 32.4;
        var lng = params.lng || -110.7;
        var zl = params.zl || 13;

        map.setView(new L.LatLng(lat, lng), zl);

        var modal = document.getElementById("modal-about");
        var btn = document.getElementById("about-button");
        var span = document.getElementsByClassName("close")[0];

        btn.onclick = function () {
            modal.style.display = "block";
        }

        span.onclick = function () {
            modal.style.display = "none";
        }

        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

    </script>
    <script>

    </script>
</body>

</html>